import{getDirname as H,path as x}from"@vuepress/utils";import{watch as k}from"chokidar";import{useSassPalettePlugin as w}from"vuepress-plugin-sass-palette";import{getPageExcerpt as E,utoa as g,getLocales as _,addViteSsrNoExternal as P}from"vuepress-shared/node";import{isArray as C}from"@vuepress/shared";import{load as j}from"cheerio";const O={"/en/":{cancel:"Cancel",placeholder:"Search",search:"Search",select:"to select",navigate:"to navigate",exit:"to exit",history:"Search History",emptyHistory:"Empty Search History",emptyResult:"No results found",loading:"Loading search indexes..."},"/zh/":{cancel:"取消",placeholder:"搜索",search:"搜索",select:"选择",navigate:"切换",exit:"关闭",history:"搜索历史",emptyHistory:"无搜索历史",emptyResult:"没有找到结果",loading:"正在加载搜索索引..."},"/zh-tw/":{cancel:"取消",placeholder:"搜索",search:"搜素",select:"選擇",navigate:"切換",exit:"關閉",history:"搜索歷史",emptyHistory:"無搜索歷史",emptyResult:"沒有找到結果",loading:"正在加載搜索索引..."},"/de/":{cancel:"Abbrechen",placeholder:"Suche",search:"Suche",select:"auswählen",navigate:"wechseln",exit:"schließen",history:"Suchverlauf",emptyHistory:"Suchverlauf leeren",emptyResult:"Keine Ergebnisse gefunden",loading:"Suchindex wird geladen..."},"/de-at/":{cancel:"Abbrechen",placeholder:"Suche",search:"Suche",select:"auswählen",navigate:"wechseln",exit:"schließen",history:"Suchverlauf",emptyHistory:"Suchverlauf leeren",emptyResult:"Keine Ergebnisse gefunden",loading:"Suchindex wird geladen..."},"/vi/":{cancel:"Hủy",placeholder:"Tìm kiếm",search:"Tìm kiếm",select:"chọn",navigate:"chuyển",exit:"đóng",history:"Lịch sử tìm kiếm",emptyHistory:"Xóa lịch sử tìm kiếm",emptyResult:"Không tìm thấy kết quả",loading:"Đang tải chỉ mục tìm kiếm..."},"/uk/":{cancel:"Скасувати",placeholder:"Пошук",search:"Пошук",select:"вибрати",navigate:"перейти",exit:"закрити",history:"Історія пошуку",emptyHistory:"Очистити історію пошуку",emptyResult:"Нічого не знайдено",loading:"Завантаження пошукових індексів..."},"/ru/":{cancel:"Отмена",placeholder:"Поиск",search:"Поиск",select:"выбрать",navigate:"переключить",exit:"закрыть",history:"История поиска",emptyHistory:"Очистить историю поиска",emptyResult:"Ничего не найдено",loading:"Загрузка поисковых индексов..."},"/br/":{cancel:"Cancelar",placeholder:"Pesquisar",search:"Pesquisar",select:"selecionar",navigate:"navegar",exit:"fechar",history:"Histórico de pesquisa",emptyHistory:"Limpar histórico de pesquisa",emptyResult:"Nenhum resultado encontrado",loading:"Carregando índices de pesquisa..."},"/pl/":{cancel:"Anuluj",placeholder:"Szukaj",search:"Szukaj",select:"wybierz",navigate:"przejdź",exit:"zamknij",history:"Historia wyszukiwania",emptyHistory:"Wyczyść historię wyszukiwania",emptyResult:"Nie znaleziono wyników",loading:"Ładowanie indeksów wyszukiwania..."},"/sk/":{cancel:"Zrušiť",placeholder:"Hľadať",search:"Hľadať",select:"vybrať",navigate:"prepnúť",exit:"zavrieť",history:"História vyhľadávania",emptyHistory:"Vymazať históriu vyhľadávania",emptyResult:"Nenašli sa žiadne výsledky",loading:"Načítavajú sa vyhľadávacie indexy..."},"/fr/":{cancel:"Annuler",placeholder:"Rechercher",search:"Rechercher",select:"sélectionner",navigate:"naviguer",exit:"fermer",history:"Historique de recherche",emptyHistory:"Vider l'historique de recherche",emptyResult:"Aucun résultat trouvé",loading:"Chargement des index de recherche..."},"/es/":{cancel:"Cancelar",placeholder:"Buscar",search:"Buscar",select:"seleccionar",navigate:"navegar",exit:"cerrar",history:"Historial de búsqueda",emptyHistory:"Vaciar historial de búsqueda",emptyResult:"No se encontraron resultados",loading:"Cargando índices de búsqueda..."},"/ja/":{cancel:"キャンセル",placeholder:"検索",search:"検索",select:"選択",navigate:"切り替え",exit:"閉じる",history:"検索履歴",emptyHistory:"検索履歴をクリア",emptyResult:"結果が見つかりません",loading:"検索インデックスを読み込んでいます..."},"/tr/":{cancel:"İptal",placeholder:"Ara",search:"Ara",select:"seç",navigate:"geç",exit:"kapat",history:"Arama geçmişi",emptyHistory:"Arama geçmişini temizle",emptyResult:"Sonuç bulunamadı",loading:"Arama dizinleri yükleniyor..."},"/ko/":{cancel:"취소",placeholder:"검색",search:"검색",select:"선택",navigate:"이동",exit:"닫기",history:"검색 기록",emptyHistory:"검색 기록 지우기",emptyResult:"결과를 찾을 수 없습니다",loading:"검색 인덱스를 로드하는 중..."},"/fi/":{cancel:"Peruuta",placeholder:"Etsi",search:"Etsi",select:"valitaksesi",navigate:"navigoidaksesi",exit:"poistuaksesi",history:"Hakuhistoria",emptyHistory:"Tyhjennä hakuhistoria",emptyResult:"Tuloksia ei löytynyt",loading:"Ladataan hakuindeksiä..."}},A="h2,h3,h4,h5,h6".split(","),L="header,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,li,main,ol,p,ul,caption,table,thead,tbody,th,tr,td,datalist,fieldset,form,legend,optgroup,option,select,details,dialog,menu,menuitem,summary,blockquote,tfoot".split(","),z="routerlink,a,b,abbr,bdi,bdo,cite,code,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,del,ins,button,label,legend,meter,optgroup,option,output,progress,select".split(","),N=j(""),b=(t,c=[],o=!1)=>{const a="excerpt"in t.data&&t.data.excerpt.length,r={title:t.title,contents:[]};let l=a||o,i="",e={header:"",slug:"",contents:[]},s=!0;const h=n=>{n.type==="tag"?A.includes(n.name)?(i&&l&&(e==null||e.contents.push(i.replace(/\s+/gu," ")),i=""),s?(e.contents.length&&r.contents.push(e),s=!1):r.contents.push(e),e={header:n.children.map(p=>p.type==="text"?p.data:"").join("").trim(),slug:n.attribs.id,contents:[]}):L.includes(n.name)?(i&&l&&(e==null||e.contents.push(i.replace(/\s+/gu," ")),i=""),n.childNodes.forEach(h)):z.includes(n.name)&&n.childNodes.forEach(h):n.type==="text"?i+=n.data.trim()?n.data:"":a&&!o&&n.type==="comment"&&n.data.trim()==="more"&&(l=!1)},u=N.parseHTML(t.contentRendered),y=Object.fromEntries(c.map(({getter:n},p)=>{const m=n(t);return C(m)?[p.toString(),m]:m?[p.toString(),[m]]:null}).filter(n=>n!==null));return!(u!=null&&u.length)&&!Object.keys(y).length?null:(u==null||u.forEach(n=>{h(n)}),l&&i&&(e==null||e.contents.push(i)),e.contents.length&&r.contents.push(e),{...r,...Object.keys(y).length?{customFields:y}:{}})},v=`
if (import.meta.webpackHot) {
  import.meta.webpackHot.accept()
  if (__VUE_HMR_RUNTIME__.updateSearchProDatabase)
    __VUE_HMR_RUNTIME__.updateSearchProDatabase(database)
}

if (import.meta.hot) {
  import.meta.hot.accept(({ database }) => {
    __VUE_HMR_RUNTIME__.updateSearchProDatabase(database);
  })
}
`;let d=null;const f=async(t,c,o=!1)=>{const{pages:a}=t;o||a.some(e=>"excerpt"in e.data)||a.forEach(e=>{e.data.excerpt=E(t,e,{excerptLength:0})});const r=a.map(e=>{const s=b(e,c.customFields,c.indexContent);return s?{path:e.path,index:s,localePath:e.pathLocale}:null}).filter(e=>e!==null),l=Object.fromEntries(Object.keys({"/":{},...t.options.locales}).map(e=>[e,Object.fromEntries(r.filter(s=>s.localePath===e).map(s=>[s.path,s.index]))]));d=l;let i=`export const database = "${g(JSON.stringify(l))}"
`;t.env.isDev&&(i+=v),await t.writeTemp("search-pro/index.js",i)},R=async(t,c,o)=>{if(d){const a=o.replace(/^pages\//,"").replace(/\/index\.html\.vue/,"/readme.md").replace(/\.html\.vue/,".md"),{env:r,pages:l,writeTemp:i}=t,e=l.find(({filePathRelative:s})=>(s==null?void 0:s.toLowerCase())===a.toLowerCase());if(e){const s=b(e,c.customFields,c.indexContent);if(s){d[e.pathLocale][e.path]=s;let h=`export const database = "${g(JSON.stringify(d))}"
`;r.isDev&&(h+=v),await i("search-pro/index.js",h);return}}}await f(t,c)},T=async(t,c,o)=>{if(d){const a=o.replace(/^pages\//,"").replace(/\/index\.html\.vue/,"/readme.md").replace(/\.html\.vue/,".md"),{env:r,pages:l,writeTemp:i}=t,e=l.find(({filePathRelative:s})=>(s==null?void 0:s.toLowerCase())===a.toLowerCase());if(e){delete d[e.pathLocale][e.path];let s=`export const database = "${g(JSON.stringify(d))}"
`;r.isDev&&(s+=v),await i("search-pro/index.js",s);return}}await f(t,c)},S=H(import.meta.url),q=t=>c=>{w(c,{id:"hope"});const o=c.pluginApi.plugins.some(({name:a})=>a==="vuepress-plugin-blog2");return{name:"vuepress-plugin-search-pro",alias:{"vuepress-plugin-search-pro/result":x.resolve(S,"../client/components/SearchResult.js")},define:{SEARCH_PRO_CUSTOM_FIELDS:Object.fromEntries((t.customFields||[]).map(({formatter:a},r)=>a?[r.toString(),a]:null).filter(a=>a!==null)),SEARCH_PRO_DELAY:t.delay||300,SEARCH_PRO_HISTORY_COUNT:t.historyCount||5,SEARCH_PRO_HOTKEYS:t.hotKeys||[{key:"k",ctrl:!0}],SEARCH_PRO_LOCALES:_({app:c,name:"search-pro",config:t.locales,default:O})},clientConfigFile:x.resolve(S,"../client/config.js"),extendsBundlerOptions:(a,r)=>{P(a,r,["fflate","vuepress-shared"])},onPrepared:a=>f(a,t,o),onWatched:(a,r)=>{if("hotReload"in t?t.hotReload:a.env.isDebug){const l=k("pages/**/*.vue",{cwd:a.dir.temp(),ignoreInitial:!0});l.on("add",i=>{R(a,t,i)}),l.on("change",i=>{R(a,t,i)}),l.on("unlink",i=>{T(a,t,i)}),r.push(l)}}}};export{q as searchProPlugin};
//# sourceMappingURL=index.js.map
